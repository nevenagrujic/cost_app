<div class="expense-container">
  <div class="expense-action-container">
    <form [formGroup]="form" class="expanse-filter-form">
      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Filter by day</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="date"
          (dateChange)="filterPerDate('change', $event)"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="standard">
        <mat-label>Filter by description</mat-label>
        <input
          formControlName="descriptionFilter"
          matInput
          (keyup)="applyFilter($event)"
          #input
        />
      </mat-form-field>

      <button mat-button (click)="resetFilter()" class="filter-button">
        Reset filter
      </button>
    </form>

    <button
      class="add-expense-action"
      mat-mini-fab
      color="primary"
      (click)="add()"
      aria-label="Add new expense"
      matTooltip="Add new expense"
      [matTooltipPosition]="'left'"
      matTooltipHideDelay="500"
    >
      <mat-icon>add</mat-icon>
    </button>
  </div>

  <table mat-table [dataSource]="expenses$ | async" class="w-100">
    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let element">{{ element.id }}</td>
    </ng-container>

    <!-- Date column -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef>Date</th>
      <td mat-cell *matCellDef="let element">
        {{ element.date | date: "dd/MM/yyyy" }}
      </td>
    </ng-container>

    <!-- Time Column -->
    <ng-container matColumnDef="time">
      <th mat-header-cell *matHeaderCellDef>Time</th>
      <td mat-cell *matCellDef="let element">{{ element.time }}</td>
    </ng-container>

    <!-- Description Column -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Description</th>
      <td mat-cell *matCellDef="let element">{{ element.description }}</td>
    </ng-container>

    <!-- Amount Column -->
    <ng-container matColumnDef="amount">
      <th mat-header-cell *matHeaderCellDef>Amount</th>
      <td mat-cell *matCellDef="let element">{{ element?.amount | number }}</td>
    </ng-container>
    <!-- Comment Column -->
    <ng-container matColumnDef="comment">
      <th mat-header-cell *matHeaderCellDef>Comment</th>
      <td mat-cell *matCellDef="let element">
        {{ element.identityCardNumber }}
      </td>
    </ng-container>

    <!-- User ID Column -->
    <ng-container matColumnDef="userId">
      <th mat-header-cell *matHeaderCellDef>User</th>
      <td mat-cell *matCellDef="let element">
        {{ (getUserByID(element.userId) | async )?.['firstName']}}
      </td>
    </ng-container>

    <ng-container matColumnDef="edit">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <button
          mat-mini-fab
          color="primary"
          aria-label="Edit expense"
          (click)="update(element)"
        >
          <mat-icon>edit</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="delete">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <button
          mat-mini-fab
          color="primary"
          aria-label="Delete expense"
          (click)="deleteExpense(element.id)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">
        No data matching the filter "{{ input.value }}"
      </td>
    </tr>
  </table>
</div>
